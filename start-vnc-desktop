#! /bin/bash
#
# Usage: start-vnc-desktop MAX-DIMENSION MIN-DIMENSION IS-TEACHER-FLAG X-DESKTOP-NUMBER USER-NAME

if [ $3 != "true" ]; then

    # Student version

    USER=`echo $5 | sed 's/ //g'`       # squash spaces

    if grep -q ^${USER}: /etc/passwd; then
        echo found
    else
        # student does not exist
	sudo adduser --gecos ${USER} --disabled-login --force-badname ${USER}
    fi

    # start monitoring Xvnc log file (which hasn't been created yet) to track number of connections
    # and record the number in a SQL database
    /home/baccala/src/osito/monitor-vnc-log /home/${USER}/.vnc/osito\:${4}.log &

    sudo su ${USER} -c "STARTUP=\"/home/baccala/src/osito/student-desktop $1 $2 $3 $4 $5\" vncserver -geometry ${1}x${2} :${4}"

else

    # Teacher version
    STARTUP="/home/baccala/src/osito/teacher-desktop $*" vncserver -geometry ${1}x${2} :${4}

fi

